## Alfred Partially Specified Tasks

This repo contains the code for Alfred's partially specified tasks. 

To run using the OPENAI GPT API, please change the `openai.api_key` in `constant.py`. 


## Generating initial states
Please change the `--init_path` and the `--scene` in `generate_initial_states.py`.

`--init_path` is where you want to store the generated initial states. 

`--scene` is the number of scene for evaluation. 
Each scene contains different setups. If you hoep to run on all scenes, please set `--scene all`. 

Here is the correspondence between the tasks listed in the paper and the scenes: 

```
"MoveSynonym": "scene22",
"MoveNextTo" : "scene9",
"MoveToCount2": "scene10",
"MoveToCount3" : "scene11",
"MoveToMore":"scene12",
"MoveNested": "scene13",
"MoveNested2": "scene14"
```

To run the script, simply run 

```python
python generate_initial_states.py --init_path init_states --scene scene9
```

This will generate the initial states as well as the objects for `scene9` and store it into the directory `init_states`.

In our experiments, `scene10` has exactly the same setup as `scene12`. Therefore, please directly copy the initial states of 
`scene12` and rename it to `scene10` in the `init_path`. 



**Note**: This step can be skipped if you wish to use the initial states generated by us (in `golden_init`). 

For each scene, 100 initial states will be generated. 

Note: There is some randomness in the generation of the initial states. When you run the `generate_initial_states.py` file, you might 
get different results each time. This is expected. 


## Generating goal PDDL
This is the key step of using GPT-3 to generate the goal state given the initial states and the natural language prompt. 

The natural language prompt are written inside the file itself. 

Before running, please change the `--gen_path` and the `init_path` to proper paths. 

The `init_path` should be a directory containing the initial states. It should be the path you used for saving the generated
results in the earlier step. 

The `gen_path` should be directory that you want to save the generated goal states to. If the directory does not exist,
the script will create a new one. 

To run the script, do 

```python
generate_goal_pddl.py --scene scene14 --init_path init_states --gen_path gen_one_shot 
```

This will generate goal states for all 100 cases in the specified scene (scene14).

If you want to just run generation on a specific case, do:

```python
python generate_goal_pddl.py --scene sceneX --case 20 --init_path init_states --gen_path gen_one_shot
```
This will run the case in SceneX with id 20. 

If you want to run generation on the first n samples in the 100 cases, do:

```python
python generate_goal_pddl.py --scene sceneX --case 20 --init_path init_states --gen_path gen_one_shot --num_case n
```

If you hope to switch between zero-shot and one-shot, please set:

```
python generate_goal_pddl.py --scene sceneX --case 20 --init_path init_states --gen_path gen_one_shot --num_case n --zero_shot
```
to toggle between zero shot and one shot. The one shot cases are written in `constant.py`.

## Evaluation of performance

The evaluation uses `evaluate.py`. Please change the variables `goal_prefix` and `init_prefix` to be the path of generated goal states 
and initial states you used during the previous steps. 

To do the evaluation for one-shot performance, do 
```
python evaluate.py --scene sceneX  --init_path init_states --gen_path gen_one_shot
```

It will evaluate the generated goal states by a set of rules specific to each scene.

For each case, besides evaluating the success of the goal-state generation itself, it also tests the models domain understanding 
and goal inference ability, by checking the correctness of the answers to the NL questions. 

The final output contains the both the success numbers and detailed error analysis used in our paper. 

Similar to the previous commands, you can also add addition arguments. This includes: 

`--zero_shot` flag, to specify whether you are running zero shot or one shot. 

`--num_case n` to only evaluate the first n cases. 



